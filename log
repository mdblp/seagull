s: "metacollection_update: params[{\"userid\":\"ddbab0d620\",\"collection\":\"profile\"}], url[/ddbab0d620/profile], method[PUT]"
s: "ENTER doUpdate addIfNotThere true userId ddbab0d620 updates {\"profile.fullName\":\"DB\",\"profile.clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}"
m: "ENTER: getDoc userId ddbab0d620"
m: "EXIT: getDoc userId ddbab0d620"
# observe that getDoc returns before "ENTER findOne continuation" -> this means that findOne is ASYNC
s: "EXIT doUpdate addIfNotThere true userId ddbab0d620 updates {\"profile.fullName\":\"DB\",\"profile.clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}"


# below we start to add preferences before completion of adding profile -> this means that to requests are interleaved
s: "metacollection_update: params[{\"userid\":\"ddbab0d620\",\"collection\":\"preferences\"}], url[/ddbab0d620/preferences], method[PUT]"
s: "ENTER doUpdate addIfNotThere true userId ddbab0d620 updates {}"
m: "ENTER: getDoc userId ddbab0d620"
m: "EXIT: getDoc userId ddbab0d620"
s: "EXIT doUpdate addIfNotThere true userId ddbab0d620 updates {}"

m: "ENTER findOne continuation"
  m: "getDoc userId ddbab0d620: not found "
  m: "ENTER: partialUpdate/getDoc (read modify write)"
    s: "ENTER process partialUdpate"
      s: "doUpdate userId ddbab0d620: 404 and addifNotThere"
      s: "createDocAndCallback userId ddbab0d620"
      m: "ENTER: createDoc userId ddbab0d620, value {}"
      m: "EXIT: createDoc userId ddbab0d620, value {}"
  m: "EXIT: partialUpdate/getDoc (read modify write)"
m: "EXIT findOne continuation"

m: "ENTER findOne continuation"
  m: "getDoc userId ddbab0d620: not found "
  m: "ENTER: partialUpdate/getDoc (read modify write)"
    s: "ENTER process partialUdpate"
    s: "doUpdate userId ddbab0d620: 404 and addifNotThere"
    s: "createDocAndCallback userId ddbab0d620"
    m: "ENTER: createDoc userId ddbab0d620, value {}"
    m: "EXIT: createDoc userId ddbab0d620, value {}"
  m: "EXIT: partialUpdate/getDoc (read modify write)"
m: "EXIT findOne continuation"

m: "ENTER insert continuation"
m: "createDoc userId ddbab0d620: created"
s: "ENTER doUpdate addIfNotThere false userId ddbab0d620 updates {\"profile.fullName\":\"DB\",\"profile.clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}"
m: "ENTER: getDoc userId ddbab0d620"
m: "EXIT: getDoc userId ddbab0d620"
s: "EXIT doUpdate addIfNotThere false userId ddbab0d620 updates {\"profile.fullName\":\"DB\",\"profile.clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}"
m: "EXIT insert continuation"

m: "ENTER insert continuation"
m: "createDoc userId ddbab0d620: duplicate key"
s: "statusCode":400,"message":"duplicate key","detail":{"code":11000,"index":0,"errmsg":"E11000 duplicate key error collection: seagull.seagull index: userId_1 dup key: { : \"ddbab0d620\" }","op":{"userId":"ddbab0d620","value":"{}" 
 ,"_id":"5d9ad7e75ad3a00011ffdb69"}},"createDocAndCallback: Error creating metadata doc"
m: "EXIT insert continuation"

m: "ENTER findOne continuation"
m: "getDoc userId ddbab0d620: found, value {}"
m: "ENTER: partialUpdate/getDoc (read modify write)"
m: "ENTER: _updateDoc userId ddbab0d620, value {\"profile\":{\"fullName\":\"DB\",\"clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}}"
m: "EXIT: _updateDoc userId ddbab0d620, value {\"profile\":{\"fullName\":\"DB\",\"clinic\":{\"role\":\"endocrinologist\",\"name\":\"DB\"}}}"
m: "EXIT: partialUpdate/getDoc (read modify write)"
m: "EXIT findOne continuation"

m: "ENTER update continuation"
m: "_updateDoc userid ddbab0d620: created"
s: "ENTER process partialUdpate"
s: "doUpdate userId ddbab0d620: success"
m: "EXIT update continuation"
